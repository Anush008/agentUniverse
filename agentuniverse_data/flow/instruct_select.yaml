name: 'instruct_select_flow'
description: "extend instruct from sample and choose the best via pre-deploy model"
nodes:
  - module: 'agentuniverse_data.node.data.prompt.instruct.seed'
    # produce multiple instruct seed candidates
    class: 'SeedNode'
    llm: 'openai_llm'
    prompt_version: 'instruct_seed_node.cn'
    param_in_jsonl:
    param_out_jsonl:
    datasets_in_jsonl:
    dataset_out_jsonl: 'instruct_select_flow.seed.out'
    node_param:
      extend_times: 10

  - module: 'agentuniverse_data.node.data.prompt.instruct.prompt_gen'
    # produce prompt from instruct and query
    class: 'PromptGenNode'
    llm: 'openai_llm'
    prompt_version: 'instruct_prompt_gen_node.cn'
    param_in_jsonl:
    param_out_jsonl:
    datasets_in_jsonl:
      # instruct jsonl
      - 'instruct_select_flow.seed.out'
      # input jsonl
      - 'dataset_build_flow.dedupe.out'
    dataset_out_jsonl: 'instruct_select_flow.prompt_gen.out'
    node_param:
      instruct_num: 10

  - module: ''
    # dump answer from pre deployed LLM infer via prompt as input
    class: 'DumpNode'
    param_in_jsonl: 'train_dump_flow.pre_deploy.out'
    param_out_jsonl:
    datasets_in_jsonl:
      - 'instruct_select_flow.prompt_gen.out'
    dataset_out_jsonl: 'instruct_select_flow.dump.out'

  - module: 'agentuniverse_data.node.eval.eval'
    # eval dump result through 7 dimensions
    class: 'EvalNode'
    llm: 'openai_llm'
    prompt_version: 'eval_node.cn'
    param_in_jsonl:
    param_out_jsonl:
    datasets_in_jsonl:
      - 'instruct_select_flow.dump.out'
    dataset_out_jsonl: 'instruct_select_flow.eval.out'
    node_param:
      eval_lines: 100

