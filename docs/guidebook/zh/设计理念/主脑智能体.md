## 主脑智能体

### 什么是主脑智能体？
主脑智能体(Cerebrum Agent)能够根据用户设定的任务目标，结合人类专家的知识，分析明确解决任务所需要的角色，创建子智能体(Slave Agent)，编排与监督智能体任务执行，从而自主完成用户交付的任务。

![主脑模式](../../_picture/cerebrum_brain_struct_zh.png)

主脑智能体(Cerebrum Agent)具备如下主要能力： 
- 思考分析解决问题所需要的所有角色
- 创建角色所对应的一系列子智能体
- 动态赋予智能体职责与能力
- 规划编排、执行、监督智能体执行过程
- 回收智能体执行反馈并综合思考给出任务结果

### 主脑模式详细工作流程与说明

![主脑模式](../../_picture/cerebrum_brain_struct.png)

#### 核心概念与对象说明
**Input**: 
- **专家经验 `E`**: 专家经验由用户提供的自然语言形式，主脑智能体在后续会基于该经验动态规划创建智能体并自主思考编排任务SOP流程。
- **任务目标 `Q`**: 用户提出的任务目标

**Resources**:  
- 工具集合 `Tools`: 可供主脑智能体分配与使用的工具列表
- 专家知识库 `PromptKnowledge`: 供主脑智能体提取、创建、赋予子智能体能力与职责，通过扩充专家知识库可以让主脑创建更加丰富种类的子智能体，从而提高任务处理的效果与表现
- 归档数据池 `ArchiveDataset`: 智能体执行过程中的过程信息归档，辅助主脑智能体监督与执行子智能体任务，改善主脑智能体面对长上下文时可能出现幻觉或遵从性差的情况，在复杂任务场景中更为关键。

**Output**: 任务的最终结果

**Procedure**:
1. 初始化归档数据池和提示词知识库
2. While `Q`未达成:
   1. 根据专家经验`E`和归档数据池中已有的结果`ArchiveDataset`决定任务的下一步执行目标`t_i` .
   2. IF `t_i` 是简单任务的话:
      1. 基于 `t_i`选择一个合适的工具`tool ∈ Tools`
      2. 从`ArchiveDataset`选择`t_i`需要的数据`data ∈ ArchiveDataset`
      2. `result ← tool.execute(t_i, data)`
   3. Else `t_i` 是一个复杂的任务:
      1. 基于 `t_i`选择一个合适的prompt`prompt ∈ PromptLibrary`
      2. 使用`prompt`创建一个子智能体 `slaveAgent`.
      3. 从`ArchiveDataset`选择`t_i`需要的数据`data ∈ ArchiveDataset`
      4. `result ← slaveAgent.run(t_i, data)`
   4. `ArchiveDataset.store(result)`
3. End While
4. 输出ArchiveDataset中存储的最终结果。


### 主脑智能体Demo案例
<div style="max-height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;">
> Entering new AgentExecutor chain...  

Thought: 这是流程的第一步。我现在依据专家经验的要求，应该执行第一步。第一步的要求是让子agent分析用户的旅行需求，制定一个完整的信息搜索计划，这一步我需要知道详细的结果，以便执行后续的流程。

Action: call_slave_rag_agent_tool

Action Input: 
```json
{
  "prompt_name": "user_query_intent_parse_prompt.cn",
  "prompt_params": {
    "user_query": "我想去杭州旅行三天，想顺带去盗墓笔记相关的地方圣地巡礼"
  },
  "save_params": {
    "name": "TravelIntentAnalysis",
    "description": "分析用户的旅行需求，包括目的地、时间、兴趣点等",
    "full_return": true
  }
}
```
1. 收集杭州地区的住宿信息，特别关注靠近“盗墓笔记”相关地点的酒店或民宿，同时了解这些住宿设施是否提供特色主题房间。
2. 收集与“盗墓笔记”相关的杭州旅游景点和活动信息，包括小说中提到的具体位置、周边环境以及是否有组织的粉丝活动或主题游。
3. 收集杭州当地的美食信息，特别是那些具有地方特色的菜肴，同时留意是否有与“盗墓笔记”文化相关的特色餐馆或小吃。

Thought: 我已经执行了专家经验的第一步。我现在依据专家经验和上一步的结果应该执行第二步，第二步的要求是根据第一步的结果调用工具搜索相关的信息，这一步需要多次执行，直到我完成了信息搜索计划中的所有流程。但我不需要知道工具详细的执行结果。我现在要使用一个工具google_search_with_archive_tool, 不允许回答Final Answer。

Action: google_search_with_archive_tool

Action Input: 
```json
{
  "query": "杭州 盗墓笔记 圣地巡礼",
  "save_params": {
    "name": "HangzhouTombRaiderSites",
    "description": "关于杭州与《盗墓笔记》相关的旅游景点和活动信息",
    "full_return": false
  }
}
```
The task is complete, you may proceed to the next step.

Thought: 我已经执行了专家经验的第二步的一部分。我现在依据专家经验和上一步的结果应该继续执行第二步，即根据第一步的结果调用工具搜索相关的信息，这一步需要多次执行，直到我完成了信息搜索计划中的所有流程。但我不需要知道工具详细的执行结果。我现在要使用一个工具google_search_with_archive_tool, 不允许回答Final Answer。
Action: google_search_with_archive_tool
Action Input: 
```json
{
  "query": "杭州 住宿 靠近 盗墓笔记 地点",
  "save_params": {
    "name": "HangzhouAccommodationNearTombRaiderSites",
    "description": "关于杭州靠近《盗墓笔记》相关地点的住宿信息",
    "full_return": false
  }
}
```
The task is complete, you may proceed to the next step.

Thought: 我已经执行了专家经验的第二步的一部分。我现在依据专家经验和上一步的结果应该继续执行第二步，即根据第一步的结果调用工具搜索相关的信息，这一步需要多次执行，直到我完成了信息搜索计划中的所有流程。但我不需要知道工具详细的执行结果。我现在要使用一个工具google_search_with_archive_tool, 不允许回答Final Answer。
Action: google_search_with_archive_tool
Action Input: 
```json
{
  "query": "杭州 美食 特色餐馆 盗墓笔记",
  "save_params": {
    "name": "HangzhouCuisineAndTombRaiderThemeRestaurants",
    "description": "关于杭州的特色美食及与《盗墓笔记》相关的主题餐馆信息",
    "full_return": false
  }
}
```

The task is complete, you may proceed to the next step.

Thought: 我已经完成了专家经验的第二步，即根据第一步的结果调用了工具搜索相关信息，包括杭州与《盗墓笔记》相关的旅游景点和活动信息、靠近《盗墓笔记》相关地点的住宿信息、以及杭州的特色美食及与《盗墓笔记》相关的主题餐馆信息。现在，依据专家经验的要求，我应该执行第三步，让子agent根据第二步中搜集到的所有信息制定一份完整的旅行计划。
Action: call_slave_rag_agent_tool
Action Input: 
```json
{
  "prompt_name": "tour_plan_prompt.cn",
  "prompt_params": {
    "user_query": "我想去杭州旅行三天，想顺带去盗墓笔记相关的地方圣地巡礼",
    "search_result": [
      "$#{HangzhouTombRaiderSites}",
      "$#{HangzhouAccommodationNearTombRaiderSites}",
      "$#{HangzhouCuisineAndTombRaiderThemeRestaurants}"
    ]
  },
  "save_params": {
    "name": "HangzhouTourPlan",
    "description": "根据用户需求定制的杭州三日游旅行计划，包括与《盗墓笔记》相关的景点、住宿和餐饮推荐",
    "full_return": true
  }
}
```
### 杭州盗墓笔记圣地巡礼三日游

**行程亮点**：这次旅行将带你走进《盗墓笔记》的世界，探访与小说中场景相似的真实地点，同时享受杭州的自然风光与美食。

#### 第一天
- **上午**
  - **8:00-9:00**：从您的出发地前往杭州，预计到达时间为上午9点左右。
  - **9:30-11:30**：参观**雷峰塔**，这里是《盗墓笔记》中提到的一个重要地点。雷峰塔不仅有着丰富的历史文化背景，其内部还藏有许多与小说相关的展览。
- **中午**
  - **12:00-13:30**：在附近的**楼外楼**享用午餐，这家餐厅以杭帮菜著称，您可以尝试一下东坡肉等经典菜肴。
- **下午**
  - **14:00-16:00**：前往**灵隐寺**，这里被认为是小说中“九门”之一的所在地。灵隐寺不仅是杭州著名的佛教寺庙，其周围的自然景观也非常美丽。
- **晚上**
  - **17:00-18:30**：入住位于**西湖边的酒店**，如**杭州西湖国宾馆**，这里交通便利，距离多个景点都很近。
  - **19:00-21:00**：晚餐推荐前往**张生记**，这是一家以《盗墓笔记》为主题的餐厅，不仅菜品丰富，店内装饰也充满了小说元素。

#### 第二天
- **上午**
  - **8:30-10:30**：前往**六和塔**，这里也是《盗墓笔记》中提到的一个重要地点。六和塔建于北宋时期，是杭州的标志性建筑之一。
- **中午**
  - **11:00-12:30**：在**知味观**享用午餐，这家餐厅以传统杭帮菜为主，您可以品尝到各种地道的杭州美食。
- **下午**
  - **13:30-15:30**：参观**西溪湿地公园**，这里被一些粉丝认为是小说中的“西沙之眼”。西溪湿地是一个自然保护区，环境优美，非常适合散步和拍照。
- **晚上**
  - **17:00-18:30**：返回酒店休息，准备晚上的活动。
  - **19:00-21:00**：晚餐推荐前往**湖滨银泰in77**内的**绿茶餐厅**，这里不仅可以品尝到美味的杭帮菜，还可以欣赏到西湖的美景。

#### 第三天
- **上午**
  - **8:30-10:30**：前往**钱塘江大桥**，这里被认为是小说中“铁索桥”的原型。钱塘江大桥是一座历史悠久的桥梁，可以在这里感受历史的沧桑。
- **中午**
  - **11:00-12:30**：在**外婆家**享用午餐，这家餐厅以家常菜为主，口味清淡，适合结束旅行前的最后一餐。
- **下午**
  - **13:30-15:30**：参观**宋城景区**，虽然这里不是《盗墓笔记》的直接取景地，但其古色古香的建筑和表演项目可以让您更好地体验宋代的文化氛围。
- **晚上**
  - **16:00-18:00**：返回酒店整理行李，准备返程。
  - **19:00**：从酒店出发，返回您的出发地。

希望这次旅行能让您充分感受到《盗墓笔记》的魅力，同时也能享受到杭州的美丽风光和美食。预祝您旅途愉快！

Thought: 我刚才完成了专家经验的第三步，这是专家经验的最后一步。我已经执行完专家经验中的所有步骤，可以结束流程了。
Final Answer: 结束

> Finished chain.
</div>
