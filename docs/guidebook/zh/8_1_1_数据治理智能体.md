# 数据治理智能体
## 介绍
**一句话介绍**：agentUniverse dataAgent通过用户指定的**问题集**，**自动化批量执行多轮智能体调用**，**生产评测数据集**，**自动化评测标注**，**产出评测报告**。

当前agentUniverse开放了**数据治理MVP版本**，将数据治理思想传递到开源社区，后续将开放离线自适应数据采集、微调数据集生成、模型推理训练、数据集多维度自动评估等完整的work flow，以强化大模型和Agent的数据治理流程。

## dataAgent流程图
![data_agent_flowchart](../_picture/data_agent_flowchart.jpg)
- data_agent包含两部分，**dataset_build_agent**负责自动化批量执行多轮智能体调用，生产评测数据集
- **dataset_eval_agent**负责自动化多维度评估数据集，产出评测报告

## dataAgent效果
在详细阐述dataAgent使用方法前，先看下dataAgent的运行效果。

- [dataAgent入口](../../../sample_standard_app/app/examples/data_agent.py): 用户构建如下智能体query集，一键启动dataAgent，生产评测数据集。
```jsonl
{"input": "英伟达股票大涨的原因是什么？"}
{"input": "贵州茅台为什么不行了？"}
```
- [dataAgent生产的评测数据集](../../../sample_standard_app/app/examples/data/dataset_turn_1_2024-07-08-20:17:28.jsonl): 生产的评测数据集以jsonl文件的格式存储智能体q&a对。
```json lines
{"prompt": "英伟达股票大涨的原因是什么？", "answer": "您的问题与提供的背景信息关于巴菲特减持比亚迪股票的情况不符，因此我无法直接回答“英伟达股票大涨的原因”。然而，如果要探讨股市中某个特定股票（如NVIDIA）的大涨，通常会考虑行业趋势、公司业绩、技术创新、市场需求增长、宏观经济环境等因素。对于英伟达这样的科技巨头，GPU性能提升、人工智能和数据中心需求的增长、以及新兴市场的扩张都可能是推动股价上涨的原因。但具体到英伟达，需要查看最新的行业报告和公司公告来了解详细情况。"}
{"prompt": "特斯拉股票为什么波动很大？", "answer": "特斯拉股票的波动性较大，主要有以下几个原因：\n\n1. 技术创新与行业竞争：特斯拉作为电动汽车行业的领导者，其技术创新能力和市场份额对投资者信心有直接影响。新产品的发布、技术突破或竞争对手的动作都可能导致股价大幅波动。\n\n2. 市场预期：特斯拉的股价常常受到市场对其增长前景、盈利能力和电池技术等未来预期的影响。如果市场对特斯拉的未来表现乐观，股价会上涨；反之，如果预期不达预期或出现负面新闻，股价可能会下跌。\n\n3. 宏观经济因素：全球经济状况、政策变化（如补贴政策）、能源政策调整等都会影响电动车行业的整体环境，从而影响特斯拉的股价。\n\n4. 融资活动：特斯拉的融资活动，如股权融资、债务融资，可能会导致股价短期内调整，尤其是如果融资条件优于市场预期。\n\n5. 泡沫与估值调整：特斯拉作为一家高成长性的公司，其股票估值可能在短期内被推高，一旦市场情绪变化或估值过高被认为难以维持，股价可能回调。\n\n6. 公司管理与舆论：CEO埃隆·马斯克的个人言行、公司战略调整以及媒体报道都可能成为股价波动的催化剂。\n\n总之，特斯拉股票的波动反映了市场对公司及其行业动态的快速反应，同时也体现了投资者对于特斯拉未来盈利能力、技术进步和市场地位的期待与担忧。"}
```
- 生产评测数据集后，dataAgent开始数据多维度评估标注，[dataAgent生产的完整评测结果](../../../sample_standard_app/app/examples/data/eval_result_turn_1_2024-07-08-20:17:28.xlsx)（包含数据多维度评估的综合分数，各维度具体分数和评估过程发现的问题）
![data_agent_eval_result](../_picture/data_agent_eval_result.png)
- [产出综合评测报告](../../../sample_standard_app/app/examples/data/eval_report_2024-07-08-20:17:28.xlsx)（包含多轮评估总平均分及各维度多轮总平均分）
![data_agent_eval_report](../_picture/data_agent_eval_report.png)

## dataAgent详细说明
### data_agent
- [配置文件](../../../sample_standard_app/app/core/agent/data_agent_case/data_agent.yaml): 配置文件主要包含两个重要项，`dataset_builder`配置生产评测数据集的智能体名称，`dataset_evaluator`配置数据评估标注的智能体名称。
- [智能体文件](../../../sample_standard_app/app/core/agent/data_agent_case/data_agent.py)
- data_agent对应的入参为query问题集路径，query问题集每条json数据需包含**一次智能体调用的完整input**。

### dataset_build_agent
- [配置文件](../../../sample_standard_app/app/core/agent/data_agent_case/dataset_build_agent.yaml): 配置文件主要包含两个重要项，`candidate`配置待评测的智能体名称（如评测demo_rag_agent效果，candidate配置demo_rag_agent），`concurrency_level`配置批量执行智能体调用时的并发度（如配置5，代表并发5调用candidate智能体）
- [智能体文件](../../../sample_standard_app/app/core/agent/data_agent_case/dataset_build_agent.py)
- dataset_build_agent生产的评测数据以jsonl格式本地存储（jsonl文件名称为dataset_turn_{i}_{date}，`i`代表轮次，`date`代表生成时间）
- 数据治理MVP版本中，dataset_build_agent不包含智能体自适应数据采集，当前实际为"**伪智能体**"形态

### dataset_eval_agent
- [配置文件](../../../sample_standard_app/app/core/agent/data_agent_case/dataset_eval_agent.yaml): 配置文件主要包含两个重要项，`llm_model`配置智能体模型，`max_eval_lines`配置评测数据行数（如配置10代表只评估前10条评测数据，避免全局评测，消耗巨大token量）
- [提示词文件](../../../sample_standard_app/app/core/prompt/dataset_eval_agent_cn.yaml)：agentUniverse当前开放了6种产业中验证有效的智能体评估标准（MVP版本未开放**全面性维度**，当前全面性评估标准偏向金融领域，故未在开源社区中提及）
- [智能体文件](../../../sample_standard_app/app/core/agent/data_agent_case/dataset_eval_agent.py)
- dataset_eval_agent生产的**完整评测结果**以excel格式本地存储（文件名称为eval_result_turn_{i}_{date}，`i`代表轮次，`date`代表生成时间）
- dataset_eval_agent生产的**综合评测报告**以excel格式本地存储（文件名称为eval_report_{date}，date代表生成时间）